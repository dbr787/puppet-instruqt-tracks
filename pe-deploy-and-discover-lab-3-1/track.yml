slug: pe-deploy-and-discover-lab-3-1
id: v3t0yr1nxnqr
type: sandbox
title: Identify Server Roles by Using Package Data Collection
teaser: Use the package data that you collect to identify the roles of the servers in your environment.
description: |-
  **What you'll learn**

  In this lab, you'll learn how to enable the package data collection feature via the PE console to discover which packages are installed across your systems. Then, you will use this information to identify the roles of the servers in your environment (web server, database server, and so on).

  When you know which packages are installed on your systems:
  - You can identify which nodes are impacted by packages you know are eligible for maintenance updates, security patches, and license renewals.
  - You can define a **role** fact to group nodes and collect configuration and performance data about a specific node group.

  **Prerequisites**

  This lab builds on concepts introduced in other PE Deploy and Discover labs. You might find it helpful to complete:
  - [Identify Your Nodes Using External Facts](https://play.instruqt.com/puppet/invite/7njh4szvazdy)

  ---

  **Keep an eye on the clock**

  ![30 minute lab](https://storage.googleapis.com/instruqt-images/Clocks%20for%20Track%20Duration/30min100.png) The virtual learning environment will stay up for 60 minutes, however, **this lab should only take about 30 minutes** to complete. When your learning environment expires, your work will not be saved. If you haven't completed the lab, you can simply restart it.

  Click **Start track** when you're ready to begin.
icon: https://storage.googleapis.com/instruqt-frontend/img/tracks/puppet.png
tags:
- ""
owner: puppet
developers:
- greg.larkin@puppet.com
- thomas.chisholm@puppet.com
- tara.swenson@puppet.com
- catherine.trinkwon@puppet.com
- alex.williamson@puppet.com
private: true
published: true
show_timer: true
challenges:
- slug: working-with-the-package-data-collector
  id: kcnxqq8o1o5d
  type: challenge
  title: View and manage packages
  teaser: Enable package collection and view the package collection report.
  notes:
  - type: text
    contents: |-
      ## Scenario

      Your team lead has given you the following list of packages and notes about the roles of the servers that have those packages installed:

      <img src="https://storage.googleapis.com/instruqt-images/PE-deploy-and-discover/lab-3.1-scenario-img.png">

      Click the arrow to the right (**>**) to continue.
  - type: text
    contents: |-
      Your team lead wants you to generate reports that show:

      - Which packages are installed on all the nodes in your environment.
      - Which nodes are web servers. From the documentation your team lead gave you, you know that web servers have the **httpd** package installed.

      To complete these tasks, you'll enable package data collection and run Puppet to collect the data. Then, you'll view the package output in the console and generate reports.

      When you know which nodes fulfill which roles, you could also define a **role** fact to group and count servers based on their functional role. You could use this information to collect configuration and performance data about a specific node group (but you won't do that in this lab).

      Click the arrow to the right (**>**) to continue.
  - type: text
    contents: |-
      By default, package data collection is disabled, so the Packages page in the PE console doesn't show any data.

      You can choose to collect package data on all your nodes or just a subset. Any node with a recent version of the Puppet agent installed can report package data, including nodes that do not have active configurations defined on the primary server.

      This lab takes about 5 minutes to spin up. When the **Start** button appears, click it to begin.
  assignment: "## Enable package data collection\n1. Log in to the PE console with username `admin` and password `puppetlabs`.\n\n2. From the console sidebar, navigate to the **Node groups** page, expand (click **+**) **PE Infrastructure**, and click the **PE Agent** node group.\n\n3. On the **Classes** tab, notice that the `puppet_enterprise::profile::agent` class has already been added to this node group, along with a couple of class-specific parameters.\n\n4. Enable package data collection.\n    1. In the **Parameter name** list for the class, select the `package_inventory_enabled` parameter and set it to `true`.\n    2. Click **Add to node group**.\n    3. Commit your change by clicking **Commit** near the bottom of the page.\n\n5. Run Puppet to apply the change to the nodes in the **PE Agent** node group.\n    1. Click **Run > Puppet** near the upper-right corner of the page.\n    2. Notice the node details, and leave the options with the default values shown.\n    3. Click **Run job** near the bottom of the page.<br><br>✏️ **Note:** This might take a few moments to complete (monitor the job status near the upper-right corner of the page).<br><br>✔️ **Result:** On this Puppet run, Puppet enables package inventory collection. On subsequent Puppet runs, Puppet collects package data and reports it on the **Packages** page.\n\n6. To start collecting and reporting package data, run Puppet a second time.\n    1. In the upper right of the **Job details** page, click **Run again > All nodes**.\n    2. Click **Run job** to start the second Puppet agent run.\n    3. Notice the job status near the upper-right corner of the page.\n\n---\n\n## View and manage package inventory\n\n1. From the console sidebar, navigate to the **Packages** page.\n\n2. For this scenario, you're trying to find the app servers, web servers, and load balancers by searching for the packages listed in the table below:\n    1. Enter the name or partial name of a package in the **Filter by package name** field and click **Apply**.\n    2. In the results list, click the package name, and notice which nodes have the package installed.\n    3. Repeat this for all the packages in the table.\n\n    | Package Name        | Server Role   | Server Name |\n    |---------------------|---------------|-------------|\n    | Java 8              | App server    | ??          |\n    | httpd               | Web server    | ??          |\n    | nginx               | Load balancer | ??          |\n\n---\n\n## Create a report of all packages installed in your environment\n\n1. On the **Packages** page, remove any filters from the previous steps.\n2. Right-click **Export Data** and click **Save link as**.\n3. Download the CSV file to your local machine and review it.\n\n---\n\n## Create a report that lists the web servers (nodes that have the **httpd** package installed)\n\n1. On the **Packages** page, in the **Filter by package name** field, enter **httpd** and click **Apply**.\n2. In the results, click **httpd**.\n3. Right-click **Export Data**, and then click **Save link as**.\n4. Download the CSV file to your local machine and review it.\n\n<br>\U0001F388 **Congratulations!** You enabled package data collection and used the information to discover the roles of the nodes in your environment.\n\n<br>To close this lab, click **Next**."
  tabs:
  - title: PE Console
    type: service
    hostname: puppet
    path: /
    port: 443
  - title: Lab Aid
    type: website
    hostname: guac
    url: https://puppet-kmo.gitbook.io/lab-aids/-MZKPjwKRKKFuXxxy7ge/pe101/identify-packages-and-server-roles-by-using-package-data-collection
  difficulty: basic
  timelimit: 3600
checksum: "9532829110886118217"
