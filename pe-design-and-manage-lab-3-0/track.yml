slug: pe-design-and-manage-lab-3-0
id: rgoha2tsmt27
type: sandbox
title: Create the Base Profile
teaser: Create the base profile
description: |2+

  # We're putting the finishing touches on this BETA Puppet Practice Lab — go ahead and take a peek!

  Please help us find any bugs that need to be zapped and share your feedback for improving this learning experience by clicking the **Bug Zapper** tab at the top of each challenge and completing the short survey.

  We welcome your suggestions and value your feedback. If you have additional comments or suggestions after completing this BETA Puppet Practice Lab, please [reach out to us directly](mailto:education@puppet.com).
  ___

  **What you'll learn**

  In this lab you will:
  1. Develop the existing placeholder code in the base profile to make use of a component module in order to configure base configuration.
  2. Add a component module to the Puppetfile.
  3. Test changes.


  **Prerequisites**

  None

  ---

  **Keep an eye on the clock**

  ![30 minute lab](https://storage.googleapis.com/instruqt-images/Clocks%20for%20Track%20Duration/30min100.png) The virtual learning environment will stay up for 60 minutes, however, **this lab should only take about 30 minutes** to complete. When your learning environment expires, your work will not be saved. If you haven't completed the lab, you can simply restart it.

  Click **Start track** when you're ready to begin.


icon: https://storage.googleapis.com/instruqt-images/bz-smallicon-1.png
tags:
- ""
owner: puppet
developers:
- thomas.chisholm@puppet.com
- alex.williamson@puppet.com
- bart.kliebert@puppet.com
private: true
published: true
show_timer: true
challenges:
- slug: create-the-base-profile
  id: 2kemewf7bxic
  type: challenge
  title: Create the base profile
  teaser: Create the base profile
  notes:
  - type: text
    contents: Create the base profile
  assignment: "# Create a control-repo locally on your Windows development workstation\n1. ![swtich tabs](https://storage.googleapis.com/instruqt-images/Instruct%20Icons/icon_switch_tabs_white_32.png) Switch to the **Windows Agent** tab.\n2. Run **Visual Studio Code** from the Start menu.\n3. Click **File** > **Autosave**.\n4. Click **File** > **Open Folder** and navigate to the **C:\\CODE directory** and select it.\n5. Click **Accept** when prompted to trust code in this directory.\n6. Click **Terminal** > **New Terminal**.\n7. In the terminal window, run the following command:\n\n        git clone git@gitea:puppet/control-repo.git\n---\n# Include a base profile in your roles\n1. Checkout the feature branch <b>webapp</b>:\n      ```\n      cd control-repo\n      git checkout webapp\n      ```\n\n3. Open the `site-modules/role/manifests/cmsweb.pp` role file and modify it to include an initial profile:\n    ```\n    # site-modules/role/manifests/cmsweb.pp\n    class role::cmsweb {\n      include profile::base\n    }\n    ```\n\n4. Do the same for the `ecommerce.pp` role in the same directory.\n    ```\n    # site-modules/role/manifests/ecommerce.pp\n    class role::ecommerce {\n      include profile::base\n    }\n    ```\n5. Do the same for the `cmsloadbalancer.pp` role in the same directory.\n    ```\n    # site-modules/role/manifests/cmsloadbalancer.pp\n    class role::cmsloadbalancer {\n      include profile::base\n    }\n    ```\n6. Run `pdk validate` to validate your code.\n    ```\n    cd site-modules\\role\n    pdk validate\n    ```\n    ✔️ **Result:** Your code passes validation.\n6. Commit and push your code to your feature branch.\n    ```\n    git add .\n    git commit -m \"Add base profile to roles\"\n    git push\n    ```\n---\n# Trigger an agent run against your environment branch\n1. ![swtich tabs](https://storage.googleapis.com/instruqt-images/Instruct%20Icons/icon_switch_tabs_white_32.png) Switch to the **PE Console** tab and login with username `admin` and password `puppetlabs`.\n\n2. Navigate to the Node Groups page and expand the All Environmments group.\n3. Click the **Development environment** group link.\n4. Click the **Classes** tab and click the **Refresh** link on the right side of the page.\n5. Click the **Matching nodes** tab to ensure all your nodes are listed for this group.\n6. Click the **Run** button in the upper right hand corner and select **Puppet** from the resulting drop-down.\n7. Choose the `webapp` environment you created in a previous step:\n    1. Under **Environment**, choose **Select an environment for nodes to run in**.\n    2. From the dropdown menu, choose **webapp**.\n1. Click **Run Job** at the lower right to begin the puppet agent run on the nodes.\n1. On the **Job Progress** screen, click  **Report** once the jobs have completed for the **winagent** node.\n1. Open the **Log** tab of any node to see the following error:\n\n    ```\n    Error: Error while evaluating a Function Call, Could not find class ::profile::base\n    ```\n\n    ❔ **Why did Puppet fail to compile the catalog?**<br>Because the base profile class you included in your roles does not yet exist.\n---\n# Create a base profile\n1. ![swtich tabs](https://storage.googleapis.com/instruqt-images/Instruct%20Icons/icon_switch_tabs_white_32.png) Switch to the **Windows Agent** tab.\n\n2. In the Visual Studio Code terminal, navigate to the `site-modules/profile` directory to create a new base profile using the pdk:\n\n    ```\n    cd ..\\profile\n    pdk new class profile::base\n    ```\n\n3. Modify the base profile in `site-modules/profile/manifests` to include code to declare the motd class:\n    ```\n    # site-modules/profile/manifests/base.pp\n    # @summary A short summary of the purpose of this class\n    #\n    # A description of what this class does\n    #\n    # @example\n    #   include profile::base\n    class profile::base {\n      class { 'motd':\n          content => \"Hello! You are in ${trusted['extensions']['pp_datacenter']}.\\n\"\n      }\n    }\n    ```\n4. Validate your code.\n    ```\n    pdk validate\n    ```\n    ✔️ **Result:** Your code passes validation.\n\n\n5. Commit and push your code to your feature branch.\n    ```\n    git add .\n    git commit -m \"Add base profile to roles\"\n    git push\n    ```\n    ✔️ **Result:** Your code will be automatically deployed to the PE server.\n\n1. ![swtich tabs](https://storage.googleapis.com/instruqt-images/Instruct%20Icons/icon_switch_tabs_white_32.png) Switch to the **PE Console** tab.\n\n1. Trigger an agent run against your environment branch, then inspect the report.<br><br>\U0001F4A1 **Tip:** If you don't recall how, the instructions are in a section above.\n---\n# See the change\nFollow the instructions for each OS below to verify your changes took effect.\n\n|Windows             |Linux            |\n|--------------------|--------------------|\n|<ol><li>![swtich tabs](https://storage.googleapis.com/instruqt-images/Instruct%20Icons/icon_switch_tabs_white_32.png) Switch to the **Windows Agent** tab.</li><br><li>Click the **Start** menu.</li><br><li>Click the user icon.</li><br><li>Select **Sign Out**.</li><br><li>When presented with the **Reconnect** option, click **Reconnect**.<br><br>✔️ **Result:** The message of the day appears on the login screen.</li></ol>|<ol><li>![swtich tabs](https://storage.googleapis.com/instruqt-images/Instruct%20Icons/icon_switch_tabs_white_32.png) Switch to the **Linux Agent** tab.</li><br><li>In the termnial, type the command `ssh root@localhost`.</li><br><li>Type `yes` when prompted.<br><br>✔️ **Result:** The message of the day appears.</li></ol><br><br><br><br><br>|\n\n\U0001F388 **Congratulations!**\nUsing the roles and profiles pattern, you built a base profile (a building block that defines a shared feature set across many nodes) to customize the login message of your nodes.\n---\n\n**Find any bugs or have feedback? Click the **Bug Zapper** tab near the top of the page and let us know!**\n\nTo close this lab, click **Next**."
  tabs:
  - title: Windows Agent
    type: service
    hostname: guac
    path: /#/client/c/winagent?username=instruqt&password=Passw0rd!
    port: 8080
  - title: PE Console
    type: service
    hostname: puppet
    path: /
    port: 443
  - title: "Bug Zapper \U0001F99F⚡"
    type: website
    hostname: guac
    url: https://docs.google.com/forms/d/e/1FAIpQLSfQK4DblKykkrbbRRp9Wofb9ehFXf2YSmVgQFlaDYe0iDzT-A/viewform?embedded=true
  - title: Primary Server
    type: terminal
    hostname: puppet
  - title: Linux Agent 1
    type: terminal
    hostname: nixagent1
  - title: Linux Agent 2
    type: terminal
    hostname: nixagent2
  - title: Git Server
    type: service
    hostname: gitea
    path: /
    port: 3000
  difficulty: basic
  timelimit: 7200
checksum: "4855882068349830632"
