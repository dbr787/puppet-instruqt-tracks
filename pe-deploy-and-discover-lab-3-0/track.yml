slug: pe-deploy-and-discover-lab-3-0
id: trd6dwmkdt6s
type: sandbox
title: 'PE Deploy and Discover - Lab 3.0: Identify Information About Your Nodes By Using facter_task & External Facts'
teaser: Use facter_task & external facts in PE to discover data about your nodes.
description: |-
  # We're putting the finishing touches on this BETA Puppet Practice Lab — go ahead and take a peek!

  Please help us find any bugs that need to be zapped and share your feedback for improving this learning experience by clicking the **Bug Zapper** tab at the top of each challenge and completing the short survey.

  We welcome your suggestions and value your feedback. If you have additional comments or suggestions after completing this BETA Puppet Practice Lab, please [reach out to us directly](mailto:education@puppet.com).
  ___

  **What you'll learn**

  In this lab, you'll run the **facter_task** task from the PE console to discover the built-in system facts that Facter gathers about each agent node. You'll also define a simple external (custom) fact to return site-specific data.

  Facts provide a foundation on which you can write conditional expressions and reusable code. Examples include:
  * Using facts in a file template to configure different versions of a file based on the fact values that the agents send to the primary server — such as creating a web server config file for each agent, where the server hostname setting is dynamically set to the hostname fact value sent by the agent.
  * Defining facts to use in PuppetDB queries or to provide the primary server with additional information for building the agent node's catalog.



  **Prerequisites**

  None

  **Before you start**

  Keep an eye on the clock. You have 30 minutes to complete this lab. After 30 minutes, your learning environment expires and your work will not be saved. If you haven't completed the lab, you can simply restart it. Click **Start track** when you're ready to begin.
icon: https://storage.googleapis.com/instruqt-images/bz-smallicon-1.png
tags:
- deploy-and-discover
owner: puppet
developers:
- greg.larkin@puppet.com
- thomas.chisholm@puppet.com
- tara.swenson@puppet.com
- catherine.trinkwon@puppet.com
private: true
published: true
show_timer: true
challenges:
- slug: use-facter-with-an-external-script
  id: br8duqywypho
  type: challenge
  title: Use Facter with an external script
  teaser: Create an external fact in a script and discover what Facter returns.
  notes:
  - type: text
    contents: |-
      Its your first day on the job at your new sysadmin role and your boss sent you a memo.

      To read the memo, click the arrow (**>**) at the right.
  - type: text
    contents: |-
      <img src="https://storage.googleapis.com/instruqt-images/PE-deploy-and-discover/lab-3.0-boss-memo.png" width="90%">

      Read the memo, and then click the arrow (**>**) at the right to continue.
  - type: text
    contents: |-
      With this new information, you'll extend Facter to identify and tag each server with its corresponding datacenter location.

      Facter — a component of the Puppet agent — gathers built-in (core) facts that are packaged within it. It can also gather custom or external facts by using scripts that you or a third party have written.

      Facter collects these facts on each Puppet run and sends them to the primary server. The primary server uses facts to build each agent's catalog.

      Click the arrow (**>**) at the right to continue.
  - type: text
    contents: |-
      In this lab, you will use the PE console to:
       * Run `facter_task` against the nodes in your environment to discover which time zone each node is located in.
       * Create an external (custom) fact to mark each node with its corresponding data center based on its time zone.

      Click **Start** when you're ready to begin.
  assignment: |
    ## Run `facter_task` in PE to retrieve data center facts:

    1. On the **PE Console** tab, log in using the ID `admin` and password `puppetlabs`.

    2. From the console sidebar, navigate to the **Tasks** page, and then click **Run a task**.

    3. In the **Task** field, enter `facter_task`.

    4. Add a fact for the task to return. In the **Parameter** field, enter `fact`. In the **Value** field, enter `timezone`, and then click **Add to task**.

    5. Specify what to run the task against. From the **Select targets** list, choose **Node list**.

    6. Search for the nodes used in this lab. In the **Add nodes** field, enter `agent` and click **Search**.

    7. Click **Add all**, and then click **Run task**.

    ✔️ Result: On the **Task Details** page, notice that the task output for each node includes the built-in `timezone` fact.

    Use the table below to determine which datacenter applies to each node's timezone. You will use this to create the datacenter fact in the following sections.
    | Time zone      | Datacenter      |
    |----------------|-----------------|
    | Eastern / EDT  | datacenter-east |
    | Pacific / PDT  | datacenter-west |

    Continue below to follow the instructions for Linux, or skip to the [Windows instructions](#windows).
    - - -
    <img src="https://storage.googleapis.com/instruqt-images/graphic-linux.png" a name="linux">

    ## Create an external fact:
    1. Check that the `datacenter` fact doesn't already exist. On the **Linux Agent** tab, run the following command (it should produce no value):
    ✏️ Tip: Click the code block to copy it, and then right-click and paste it on the command line.
    ```
    facter datacenter
    ```
    2. Move the provided external fact script into place. Navigate to your home directory:

    ```
    cd
    ```

    3. Create the Facter location directory and external fact script:

    ```
    mkdir -p /etc/puppetlabs/facter/facts.d
    ```

    4. Open the script in the vi editor:
    ```
    vi /etc/puppetlabs/facter/facts.d/datacenter.sh
    ```

    5. Add the following contents to the script, replacing `<DATACENTER>` with the **Datacenter** value that corresponded to the node's `timezone` fact (which was returned when you ran `facter_task` on the PE Console).
    ```
    #!/usr/bin/env bash
    echo "datacenter=<DATACENTER>"
    ```

    ✏️ Tip: To paste text into Vi, type `:set paste`, press **Enter**, and then press `i`. Enter the correct datacenter, then save and exit by pressing `ESC` and typing `:wq`.

    6. Run the following command make the script executable:
    ```
    chmod +x /etc/puppetlabs/facter/facts.d/datacenter.sh
    ```

    ## Verify that the fact was installed and is accessible by Facter:

    7. Run `facter datacenter` again and notice the new output: Facter should return `datacenter-west`.

    8. Run Puppet to send all facts (built-in and external) to the primary Puppet server:
    ```
    puppet agent -t
    ```

    9. On the **PE Console** tab, navigate to the **Nodes** page and click the `nixagent` node. On the **Facts** tab, scroll to view the `datacenter` fact displayed in the list.

    **Congratulations!** You installed an external fact script to create a `datacenter` fact, and then verified that Facter can retrieve the data in the fact.

    **Find bugs or have feedback? Click the **Bug Zapper** tab near the top of the page and let us know!**

    To try this on Windows, read on. To close this lab, click **Next**.

    - - -
    <a name="windows"><img src="https://storage.googleapis.com/instruqt-images/graphic-windows.png"></a>

    ## Create an external fact:
    1. Check that the data center fact doesn't already exist. On the **Windows Agent** tab, open a Powershell window from the **Start** menu, and then run the following command (it should produce no value):

    ✏️ Tip: Click the code block to copy it, and then right-click and paste it.

    ```
    facter datacenter
    ```

    2. Move the provided external fact script into place by creating the following file (click **Yes** when prompted to create the file):
    ```
    notepad C:\ProgramData\PuppetLabs\facter\facts.d\datacenter.ps1
    ```

    3. Add the following contents to the file, replacing `<DATACENTER>` with the **Datacenter** value that corresponded to the node's `timezone` fact (which was returned when you ran `facter_task` on the PE console). Then, save and exit the file.
    ```
    write-host "datacenter=<DATACENTER>"
    ```

    ## Verify that the fact was installed and is accessible by Facter:
    4. Run `facter datacenter` again and notice the new output - Facter should return `datacenter-east`.

    5. Run Puppet to send all facts (built-in and external) to the primary Puppet server:
    ```
    puppet agent -t
    ```

    6. On the **PE Console** tab, navigate to **Nodes** and click the `winagent` node. On the **Facts** tab, scroll to view the `datacenter` fact shown in the list.

    **Congratulations!** You installed an external fact script to create a `datacenter` fact, and then verified that Facter was able to retrieve the data in the fact.

    **Find bugs or have feedback? Click the **Bug Zapper** tab near the top of the page and let us know!**

    To close this lab, click **Next**.
  tabs:
  - title: PE Console
    type: service
    hostname: puppet
    port: 443
  - title: Linux Agent
    type: terminal
    hostname: nixagent
  - title: Windows Agent
    type: service
    hostname: guac
    path: /#/client/c/winagent?username=instruqt&password=Passw0rd!
    port: 8080
  - title: "Bug Zapper \U0001F99F⚡"
    type: website
    hostname: guac
    url: https://docs.google.com/forms/d/e/1FAIpQLSfeCPR2SFCb_xCGvz-8gcXk5bncpBdFkXUovtzR0Yjfil1cAw/viewform?embedded=true
  difficulty: basic
  timelimit: 1800
checksum: "5274564153484223227"
